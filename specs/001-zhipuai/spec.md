# Feature Specification: 新闻管理系统

**Feature Branch**: `001-zhipuai`  
**Created**: 2025-10-10  
**Status**: Draft  
**Input**: User description: "我需要做一个新闻管理系统，要可以从新浪网，央视网，网易新闻爬取新闻，然后管理员可以增删改查，然后连接zhipuai总结当前新闻，页面设计可以参考网易新闻，要有登录界面"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 管理员登录和身份验证 (Priority: P1)

管理员需要通过安全的登录系统访问新闻管理功能。系统应该验证管理员身份，并在成功登录后提供对管理功能的访问权限。

**Why this priority**: 这是整个系统的基础功能，没有身份验证就无法保护管理功能的安全性，必须首先实现。

**Independent Test**: 可以通过创建测试账户、尝试登录、验证访问权限来独立测试，无需其他功能即可验证登录系统的完整性。

**Acceptance Scenarios**:

1. **Given** 管理员在登录页面输入有效的用户名和密码, **When** 点击登录按钮, **Then** 系统验证凭证并重定向到新闻管理主页面
2. **Given** 管理员输入无效的用户名或密码, **When** 点击登录按钮, **Then** 系统显示错误提示并保持在登录页面
3. **Given** 管理员已登录系统, **When** 在30分钟内无操作, **Then** 系统自动注销并要求重新登录
4. **Given** 未登录的用户, **When** 尝试直接访问管理功能URL, **Then** 系统重定向到登录页面

---

### User Story 2 - 新闻内容管理 (Priority: P2)

管理员需要能够查看、编辑、删除现有新闻内容，以及手动添加新的新闻条目。管理员应该能够修改新闻标题、正文、来源、发布时间等信息，并能够永久删除不适合发布的新闻。

**Why this priority**: 这是核心管理功能，使管理员能够控制新闻内容的质量和准确性，是系统的主要价值所在。

**Independent Test**: 可以通过预先填充一些测试新闻数据，然后执行增删改查操作来独立测试，验证所有管理操作是否正常工作。

**Acceptance Scenarios**:

1. **Given** 管理员在新闻列表页面, **When** 点击"添加新闻"按钮并填写完整信息, **Then** 系统保存新新闻并在列表中显示
2. **Given** 管理员在新闻列表中选择一条新闻, **When** 点击"编辑"并修改内容后保存, **Then** 系统更新新闻内容并显示修改后的信息
3. **Given** 管理员在新闻列表中选择一条新闻, **When** 点击"删除"并确认操作, **Then** 系统永久删除该新闻并从列表中移除
4. **Given** 管理员在新闻列表页面, **When** 使用搜索或筛选功能, **Then** 系统显示符合条件的新闻列表
5. **Given** 管理员编辑新闻时, **When** 必填字段为空, **Then** 系统显示验证错误并阻止保存

---

### User Story 3 - 多源新闻采集 (Priority: P3)

系统需要自动从多个新闻网站（新浪网、央视网、网易新闻）采集最新的新闻内容，并存储到系统中供管理员审核和发布。采集的新闻应包括标题、正文、发布时间、来源网站等信息。

**Why this priority**: 虽然重要，但可以在管理功能完成后再实现。管理员可以先手动添加新闻，等自动采集功能就绪后再启用。

**Independent Test**: 可以通过配置采集规则、手动触发采集任务、验证采集的新闻数据完整性来独立测试，不依赖其他用户故事。

**Acceptance Scenarios**:

1. **Given** 系统配置了新闻源采集规则, **When** 定时采集任务运行, **Then** 系统从所有配置的新闻源采集最新新闻并存储
2. **Given** 新闻采集完成, **When** 管理员查看采集的新闻列表, **Then** 系统显示所有新采集的新闻及其来源标识
3. **Given** 采集过程中遇到网络错误或源网站不可用, **When** 采集任务执行, **Then** 系统记录错误日志并继续采集其他源
4. **Given** 系统检测到重复的新闻内容, **When** 采集任务运行, **Then** 系统跳过重复内容避免数据冗余
5. **Given** 管理员, **When** 手动触发立即采集, **Then** 系统立即执行采集任务并显示采集结果

---

### User Story 4 - AI 智能新闻摘要生成 (Priority: P4)

系统应该能够使用 AI 技术自动为新闻内容生成简洁的摘要。管理员可以选择一条或多条新闻，系统调用 AI 服务分析新闻内容并生成摘要，帮助用户快速了解新闻要点。

**Why this priority**: 这是增值功能，可以提升用户体验，但不影响核心的新闻管理功能，可以在基础功能稳定后再实现。

**Independent Test**: 可以通过准备测试新闻内容、触发摘要生成、验证生成的摘要质量和准确性来独立测试。

**Acceptance Scenarios**:

1. **Given** 管理员选择一条新闻, **When** 点击"生成摘要"按钮, **Then** 系统调用 AI 服务生成摘要并显示在新闻详情中
2. **Given** 系统正在生成摘要, **When** AI 服务响应较慢, **Then** 系统显示加载状态并在完成后更新摘要
3. **Given** AI 服务不可用或返回错误, **When** 尝试生成摘要, **Then** 系统显示友好的错误提示并允许重试
4. **Given** 新闻已有 AI 生成的摘要, **When** 管理员再次点击"生成摘要", **Then** 系统提示是否覆盖现有摘要
5. **Given** 管理员选择多条新闻, **When** 批量生成摘要, **Then** 系统依次处理每条新闻并显示处理进度

---

### User Story 5 - 新闻浏览和阅读体验 (Priority: P5)

普通用户（非管理员）需要能够浏览新闻列表、查看新闻详情、阅读新闻内容和 AI 生成的摘要。界面应该清晰、易用，提供良好的阅读体验，支持按分类、时间、热度等维度浏览新闻。

**Why this priority**: 这是面向最终用户的功能，在管理功能和内容采集完成后实现，确保有足够的新闻内容供用户浏览。

**Independent Test**: 可以通过预先填充新闻数据、模拟用户浏览和阅读行为、验证界面响应和内容展示来独立测试。

**Acceptance Scenarios**:

1. **Given** 用户访问新闻网站首页, **When** 页面加载完成, **Then** 系统显示智能排序的新闻列表，包括标题、摘要、发布时间和来源，热门和新鲜的新闻优先展示
2. **Given** 用户在新闻列表页, **When** 点击新闻标题, **Then** 系统打开新闻详情页并显示完整内容和 AI 摘要，同时增加该新闻的浏览量
3. **Given** 用户在新闻详情页, **When** 滚动浏览内容, **Then** 系统提供流畅的阅读体验，文本清晰，排版美观
4. **Given** 用户使用移动设备访问, **When** 浏览新闻, **Then** 系统自动适配屏幕尺寸，提供响应式布局
5. **Given** 用户在首页, **When** 使用分类或筛选功能, **Then** 系统显示符合条件的智能排序新闻列表

---

### Edge Cases

- **当新闻源网站结构发生变化时**：采集功能可能失败，系统应记录错误并通知管理员
- **当 AI 服务配额耗尽或限流时**：系统应优雅降级，提示管理员等待或使用备用方案
- **当管理员同时编辑同一条新闻时**：系统应检测并发编辑，防止数据覆盖丢失
- **当采集的新闻内容包含非法或敏感内容时**：系统应提供内容审核机制，允许管理员标记或删除
- **当用户在没有网络连接时访问网站**：系统应显示友好的错误提示
- **当新闻内容过长或包含特殊字符时**：系统应正确处理和显示，避免布局错乱
- **当管理员删除正在被用户浏览的新闻时**：系统应优雅处理，显示"新闻已删除"提示
- **当不同来源采集到标题完全相同的新闻时**：系统跳过后续采集的重复项，仅保留首次采集的版本
- **当自动分类规则无法匹配任何分类时**：系统应将新闻标记为"待分类"状态，需要管理员手动分配分类
- **当多条分类规则同时匹配同一条新闻时**：系统应根据规则优先级选择分类，优先级相同时选择第一条匹配的规则
- **当采集的新闻包含不当内容但已自动发布时**：管理员应能够快速发现并删除或隐藏该新闻，系统需提供便捷的管理界面

## Requirements *(mandatory)*

### Functional Requirements

#### 认证与授权
- **FR-001**: 系统必须提供管理员登录功能，验证用户名和密码
- **FR-002**: 系统必须区分管理员和普通用户的访问权限
- **FR-003**: 系统必须在会话超时后自动注销用户（默认30分钟）
- **FR-004**: 系统必须阻止未登录用户访问管理功能

#### 新闻管理
- **FR-005**: 管理员必须能够手动创建新闻，包括标题、正文、来源、分类、发布时间等字段
- **FR-006**: 管理员必须能够编辑现有新闻的所有字段
- **FR-007**: 管理员必须能够删除新闻
- **FR-008**: 管理员必须能够查看所有新闻的列表，支持分页显示
- **FR-009**: 管理员必须能够搜索和筛选新闻（按标题、来源、日期、分类等）
- **FR-010**: 系统必须验证新闻必填字段（标题、正文不能为空）
- **FR-011**: 系统必须提供预定义的默认新闻分类（如：政治、经济、体育、娱乐、科技、社会等）
- **FR-012**: 管理员必须能够创建、编辑和删除自定义新闻分类
- **FR-013**: 每条新闻必须分配到一个分类中（默认或自定义）

#### 新闻采集
- **FR-014**: 系统必须能够从新浪网、央视网、网易新闻三个来源采集新闻内容
- **FR-015**: 系统必须定时自动执行新闻采集任务，采集频率可由管理员配置（支持小时、天为单位）
- **FR-016**: 管理员必须能够手动触发立即采集任务
- **FR-017**: 系统必须检测并避免采集重复的新闻内容，通过标题完全匹配判断（标题相同即视为重复）
- **FR-018**: 系统必须在采集失败时记录错误日志
- **FR-019**: 采集的新闻必须包含：标题、正文、来源网站、原始URL、发布时间、采集时间
- **FR-020**: 管理员必须能够在系统设置中配置新闻采集频率（例如：每1小时、每4小时、每天）
- **FR-021**: 系统必须为采集的新闻自动分配分类，优先使用来源预设规则（可由管理员配置，如"央视网政治频道→政治分类"）
- **FR-022**: 当来源预设规则无法匹配时，系统必须使用关键词匹配机制为新闻分类（标题或正文包含特定关键词则归入对应分类）
- **FR-023**: 管理员必须能够配置和管理来源分类规则和关键词分类规则
- **FR-024**: 采集的新闻必须自动设置为"已发布"状态，立即对用户可见，无需人工审核

#### AI 摘要生成
- **FR-025**: 系统必须能够为单条新闻生成 AI 摘要
- **FR-026**: 系统必须能够批量为多条新闻生成 AI 摘要
- **FR-027**: 系统必须在摘要生成过程中显示加载状态
- **FR-028**: 系统必须在 AI 服务失败时显示错误提示并允许重试
- **FR-029**: 生成的摘要必须存储并与新闻内容关联

#### 用户浏览
- **FR-030**: 系统必须向所有用户（无需登录）展示新闻列表
- **FR-031**: 用户必须能够点击新闻标题查看完整内容
- **FR-032**: 新闻详情页必须显示标题、正文、来源、发布时间、AI 摘要（如有）
- **FR-033**: 系统必须提供响应式界面，支持桌面端、平板端、移动端访问
- **FR-034**: 用户必须能够按分类、时间等维度筛选新闻
- **FR-035**: 系统必须支持新闻列表分页加载，每页显示合理数量的新闻（建议10-20条）
- **FR-036**: 新闻列表必须采用智能混合排序，综合考虑发布时间（新鲜度）、浏览量（热度）等因素，优先展示最相关的新闻
- **FR-037**: 系统必须记录每条新闻的浏览量，用于排序算法

#### 性能与可靠性
- **FR-038**: 系统必须确保新闻采集失败不影响现有新闻数据
- **FR-039**: 系统必须在数据库操作失败时回滚事务，保证数据一致性
- **FR-040**: 系统必须记录所有管理操作的审计日志（谁、何时、做了什么）

### Key Entities

- **用户（User）**: 系统使用者，包含用户名、密码（加密存储）、角色（管理员/普通用户）、创建时间、最后登录时间
- **新闻分类（Category）**: 新闻分类标签，包含分类名称、分类描述、是否为默认分类、创建时间、创建人；系统预置默认分类（政治、经济、体育、娱乐、科技、社会等），管理员可添加自定义分类
- **分类规则（ClassificationRule）**: 自动分类规则配置，包含规则类型（来源规则/关键词规则）、来源网站/频道（如"央视网政治频道"）、关键词列表、目标分类ID、优先级、启用状态
- **新闻（News）**: 新闻内容主体，包含标题、正文、来源网站、原始URL、分类ID（关联到Category）、发布时间、采集时间、创建人、状态（草稿/已发布）、分类方式（手动/自动）、浏览量；自动采集的新闻默认为"已发布"状态，管理员手动创建的新闻可保存为"草稿"；浏览量用于智能排序算法
- **AI 摘要（Summary）**: 与新闻关联的 AI 生成摘要，包含摘要内容、生成时间、关联的新闻ID
- **采集任务（CrawlTask）**: 新闻采集任务记录，包含任务ID、目标来源、开始时间、结束时间、状态（运行中/成功/失败）、采集数量、错误信息
- **审计日志（AuditLog）**: 管理操作记录，包含操作人、操作类型（创建/编辑/删除）、操作对象、操作时间、操作前后的数据快照

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 管理员能够在5秒内完成登录流程，从输入凭证到进入管理界面
- **SC-002**: 管理员能够在1分钟内完成一条新闻的创建或编辑操作
- **SC-003**: 新闻采集任务能够在10分钟内完成一次完整的三源采集，每个源采集至少10条新闻
- **SC-004**: AI 摘要生成在90%的情况下能够在30秒内完成
- **SC-005**: 用户浏览新闻列表页面，页面加载时间（LCP）在2.5秒以内
- **SC-006**: 系统能够支持至少100个并发用户同时浏览新闻而不出现性能下降
- **SC-007**: 新闻内容在管理员发布后，普通用户能够在5秒内在列表中看到更新
- **SC-008**: 采集的新闻重复率低于5%（即95%的采集内容是新的、未重复的）
- **SC-009**: 90%的管理员能够在首次使用时无需培训即可完成基本的增删改查操作
- **SC-010**: 系统在移动设备上的可用性评分（可通过用户测试）达到4分以上（满分5分）
- **SC-011**: 自动分类系统的准确率达到70%以上（通过管理员抽样审核验证）
- **SC-012**: 用户在首页平均浏览3条新闻后能找到感兴趣的内容（通过智能排序提升内容发现效率）

## Assumptions

以下是基于行业标准和常见实践做出的合理假设：

1. **认证方式**: 采用传统的用户名密码认证方式，密码使用标准加密算法存储
2. **会话管理**: 使用基于会话的认证，会话超时时间为30分钟
3. **数据保留**: 新闻数据永久保留，除非管理员明确删除
4. **采集策略**: 采集最新的新闻内容，不回溯历史数据
5. **AI 服务**: 使用智谱AI作为摘要生成服务，假设服务具有合理的可用性和响应时间
6. **用户量**: 系统设计支持中小规模用户量（100-1000并发用户）
7. **内容审核**: 初期依赖管理员人工审核，不包含自动内容过滤
8. **多语言**: 初期仅支持中文内容，不包含国际化需求
9. **界面设计**: 参考网易新闻的界面风格，提供现代、简洁的用户体验

## Clarifications

### Session 2025-10-10

- Q: 新闻分类系统应该如何实现？ → A: 混合模式：系统提供默认分类，管理员也可以添加新分类
- Q: 系统应该如何判断新闻是否重复？ → A: 根据新闻标题完全匹配判断（标题相同即为重复）
- Q: 从外部源采集的新闻应该如何分配分类？ → A: 组合策略：优先使用来源预设规则自动分类，辅以关键词匹配作为补充机制
- Q: 从外部源采集的新闻初始状态应该是什么？ → A: 直接设为"已发布"状态，立即对用户可见（信任自动采集）
- Q: 新闻列表的默认排序规则应该是什么？ → A: 智能混合排序（综合考虑时间、热度等因素）

## Clarifications Resolved

所有关键问题已在规范制定过程中得到澄清：

1. **采集频率**: 已决定采用自定义配置方案，管理员可以在系统设置中配置采集频率（支持小时、天为单位），提供最大灵活性
