# ğŸ”§ çˆ¬è™«é‡‡é›†æ•°é‡é—®é¢˜è§£å†³æ–¹æ¡ˆ

## ğŸ¯ é—®é¢˜ç°è±¡

**è®¾ç½®**ï¼šmaxCount = 10  
**å®é™…ç»“æœ**ï¼šåªé‡‡é›†åˆ° 3 æ¡

## ğŸ” é—®é¢˜åŸå› 

### æ ¹æœ¬åŸå› 

çˆ¬è™«ä»£ç ä¸­çš„ `maxCount` å‚æ•°æ˜¯**æœ€å¤§æ•°é‡é™åˆ¶**ï¼Œä½†å®é™…é‡‡é›†æ•°é‡å–å†³äºï¼š

1. **ç½‘é¡µä¸Šèƒ½è§£æå‡ºçš„é“¾æ¥æ•°é‡** â† ä¸»è¦åŸå› 
2. è¿‡æ»¤æ¡ä»¶æ˜¯å¦å¤ªä¸¥æ ¼
3. ç½‘ç«™é¡µé¢ç»“æ„æ˜¯å¦å˜åŒ–

### å…·ä½“åˆ†æ

æŸ¥çœ‹ä»£ç å¯ä»¥çœ‹åˆ°ï¼š

```java
// CCTV çˆ¬è™«çš„é“¾æ¥è§£æ
protected List<String> parseNewsLinks(Document doc, int maxCount) {
    List<String> links = new ArrayList<>();
    
    // é€‰æ‹©å™¨ï¼ša[href*=cctv.com]
    Elements newsElements = doc.select("a[href*=cctv.com]");
    
    for (Element element : newsElements) {
        String href = element.attr("href");
        
        // è¿‡æ»¤æ¡ä»¶å¾ˆä¸¥æ ¼
        if (href.contains("/news.cctv.com/") || 
            href.contains("/m.news.cctv.com/")) {
            
            // å¿…é¡»åŒ¹é…æ—¥æœŸæ ¼å¼ï¼š/2024/10/14/
            if (fullUrl.matches(".*\\d{4}/\\d{2}/\\d{2}/.*")) {
                links.add(fullUrl);
            }
            
            if (links.size() >= maxCount) {
                break;  // è¿™é‡Œä¼šåœæ­¢
            }
        }
    }
    
    return links;  // å®é™…å¯èƒ½åªæœ‰3æ¡
}
```

**é—®é¢˜æ‰€åœ¨ï¼š**
- é¦–é¡µä¸Šç¬¦åˆæ¡ä»¶çš„æ–°é—»é“¾æ¥ç¡®å®åªæœ‰ 3 æ¡
- è¿‡æ»¤æ¡ä»¶ï¼ˆå¿…é¡»åŒ…å«æ—¥æœŸæ ¼å¼ï¼‰å¤ªä¸¥æ ¼
- æ–°é—»ç½‘ç«™é¦–é¡µé€šå¸¸ä¸ä¼šæ˜¾ç¤ºå¤ªå¤šæ–°é—»é“¾æ¥

---

## âœ… è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1: æ”¹è¿›çˆ¬è™«é€‰æ‹©å™¨ï¼ˆæ¨èï¼‰

éœ€è¦ä¿®æ”¹çˆ¬è™«ä»£ç ï¼Œè®©å®ƒèƒ½ä»æ›´å¤šé¡µé¢è·å–é“¾æ¥ã€‚

#### CCTV çˆ¬è™«æ”¹è¿›

**æ–‡ä»¶ï¼š** `backend/src/main/java/com/news/crawler/impl/CctvNewsCrawler.java`

```java
@Override
protected List<String> parseNewsLinks(Document doc, int maxCount) {
    List<String> links = new ArrayList<>();
    
    try {
        // æ–¹æ¡ˆ1: æ”¾å®½é€‰æ‹©å™¨ï¼Œè·å–æ›´å¤šé“¾æ¥
        Elements newsElements = doc.select("a[href*=news.cctv.com]");
        
        for (Element element : newsElements) {
            String href = element.attr("href");
            
            // æ”¾å®½è¿‡æ»¤æ¡ä»¶
            if (href.contains("news.cctv.com") && 
                !href.contains("javascript") &&
                !href.endsWith(".jpg") &&
                !href.endsWith(".png")) {
                
                String fullUrl = href.startsWith("http") ? href : buildFullUrl(BASE_URL, href);
                
                // ç®€åŒ–åŒ¹é…æ¡ä»¶ï¼ŒåŒ…å«å¹´ä»½å³å¯
                if (fullUrl.matches(".*\\d{4}.*") && !links.contains(fullUrl)) {
                    links.add(fullUrl);
                }
                
                if (links.size() >= maxCount) {
                    break;
                }
            }
        }
        
        // æ–¹æ¡ˆ2: å¦‚æœé¦–é¡µé“¾æ¥ä¸å¤Ÿï¼Œå°è¯•è®¿é—®åˆ—è¡¨é¡µ
        if (links.size() < maxCount) {
            String listPageUrl = "https://news.cctv.com/2019/07/gaiban/cmsdatainterface/page/news_1.jsonp";
            // è®¿é—®æ›´å¤šé¡µé¢è·å–é“¾æ¥
            // ...
        }
        
        log.info("Parsed {} news links from CCTV", links.size());
        
    } catch (Exception e) {
        log.error("Failed to parse news links: {}", e.getMessage());
    }
    
    return links;
}
```

#### ç½‘æ˜“çˆ¬è™«æ”¹è¿›

**ç½‘æ˜“é—®é¢˜æ›´ä¸¥é‡**ï¼šæ­£åˆ™è¡¨è¾¾å¼å¤ªä¸¥æ ¼

```java
// åŸä»£ç ï¼š
if (href.matches(".*\\d{2}/\\d{4}/.*\\.html"))  // å¤ªä¸¥æ ¼ï¼

// æ”¹è¿›åï¼š
if (href.contains("news.163.com") && 
    href.endsWith(".html") &&
    !links.contains(href)) {
    links.add(href);
}
```

---

### æ–¹æ¡ˆ2: ä½¿ç”¨APIæ¥å£ï¼ˆæ›´å¯é ï¼‰

å¾ˆå¤šæ–°é—»ç½‘ç«™æä¾›APIæ¥å£ï¼Œæ¯”ä½¿ç”¨ç½‘é¡µçˆ¬è™«æ›´ç¨³å®šã€‚

**ç¤ºä¾‹ï¼šåˆ›å»º API çˆ¬è™«**

```java
@Component
@Slf4j
public class CctvApiCrawler extends AbstractNewsCrawler {
    
    @Override
    protected List<String> parseNewsLinks(Document doc, int maxCount) {
        List<String> links = new ArrayList<>();
        
        // ä½¿ç”¨APIè·å–æ–°é—»åˆ—è¡¨
        String apiUrl = "https://api.cctv.com/news/list?page=1&size=" + maxCount;
        
        try {
            // è°ƒç”¨API
            String jsonResponse = fetchJson(apiUrl);
            JSONArray newsArray = new JSONArray(jsonResponse);
            
            for (int i = 0; i < Math.min(newsArray.length(), maxCount); i++) {
                JSONObject news = newsArray.getJSONObject(i);
                String url = news.getString("url");
                links.add(url);
            }
            
        } catch (Exception e) {
            log.error("Failed to fetch from API: {}", e.getMessage());
        }
        
        return links;
    }
}
```

---

### æ–¹æ¡ˆ3: ä½¿ç”¨RSSè®¢é˜…ï¼ˆæœ€ç®€å•ï¼‰

å¾ˆå¤šæ–°é—»ç½‘ç«™æä¾›RSSæºï¼Œè¿™æ˜¯æœ€ç¨³å®šçš„æ–¹å¼ã€‚

**RSSåœ°å€ï¼š**
- CCTV: `http://rss.cctv.com/rss/news.xml`
- æ–°æµª: `http://news.sina.com.cn/rss/news.xml`
- ç½‘æ˜“: `http://news.163.com/rss/news.xml`

---

### æ–¹æ¡ˆ4: ä¸´æ—¶è§£å†³ - å¤šæ¬¡é‡‡é›†

åœ¨å½“å‰ä»£ç ä¸å˜çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥å¤šæ¬¡è¿è¡Œé‡‡é›†ï¼š

1. ç¬¬ä¸€æ¬¡é‡‡é›†ï¼šè·å–3æ¡
2. ç­‰å¾…å‡ åˆ†é’Ÿï¼ˆæ–°é—»æ›´æ–°ï¼‰
3. ç¬¬äºŒæ¬¡é‡‡é›†ï¼šå†è·å–3æ¡æ–°çš„
4. é‡å¤å¤šæ¬¡ç›´åˆ°æ»¡è¶³éœ€æ±‚

---

## ğŸ› ï¸ å¿«é€Ÿä¿®å¤ï¼ˆæ¨èï¼‰

### ä¿®æ”¹1: æ”¾å®½CCTVè¿‡æ»¤æ¡ä»¶

**æ–‡ä»¶ï¼š** `CctvNewsCrawler.java:54è¡Œ`

```java
// åŸä»£ç ï¼ˆå¤ªä¸¥æ ¼ï¼‰ï¼š
if (fullUrl.matches(".*\\d{4}/\\d{2}/\\d{2}/.*") && 
    !links.contains(fullUrl)) {
    links.add(fullUrl);
}

// ä¿®æ”¹ä¸ºï¼ˆæ›´å®½æ¾ï¼‰ï¼š
if (fullUrl.contains("news.cctv.com") && 
    fullUrl.matches(".*\\d{4}.*") &&  // åªè¦åŒ…å«å¹´ä»½
    !href.endsWith(".jpg") &&
    !href.endsWith(".png") &&
    !links.contains(fullUrl)) {
    links.add(fullUrl);
}
```

### ä¿®æ”¹2: ä¿®å¤ç½‘æ˜“çˆ¬è™«

**æ–‡ä»¶ï¼š** `NeteaseNewsCrawler.java:49è¡Œ`

```java
// åŸä»£ç ï¼ˆå¤ªä¸¥æ ¼ï¼‰ï¼š
if (href.contains("/news.163.com/") && 
    href.matches(".*\\d{2}/\\d{4}/.*\\.html") &&
    !links.contains(href)) {

// ä¿®æ”¹ä¸ºï¼ˆæ›´å®½æ¾ï¼‰ï¼š
if (href.contains("news.163.com") && 
    href.endsWith(".html") &&
    href.matches(".*\\d+.*") &&  // åŒ…å«æ•°å­—å³å¯
    !links.contains(href)) {
```

### ä¿®æ”¹3: æ–°æµªçˆ¬è™«å·²ç»ç›¸å¯¹è¾ƒå¥½

æ–°æµªçˆ¬è™«çš„è¿‡æ»¤æ¡ä»¶æ¯”è¾ƒåˆç†ï¼Œä½†å¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–ã€‚

---

## ğŸ“ å®Œæ•´ä»£ç ç¤ºä¾‹

ä»¥ä¸‹æ˜¯æ”¹è¿›åçš„ CCTV çˆ¬è™«å®Œæ•´ç¤ºä¾‹ï¼š

```java
@Override
protected List<String> parseNewsLinks(Document doc, int maxCount) {
    List<String> links = new ArrayList<>();
    
    try {
        // 1. è·å–æ‰€æœ‰å¯èƒ½çš„æ–°é—»é“¾æ¥
        Elements newsElements = doc.select("a[href]");
        
        for (Element element : newsElements) {
            String href = element.attr("abs:href");  // è‡ªåŠ¨è½¬æ¢ä¸ºç»å¯¹URL
            
            // 2. åŸºæœ¬è¿‡æ»¤
            if (href.contains("news.cctv.com") &&
                !href.contains("javascript") &&
                !href.contains("images") &&
                !href.endsWith(".jpg") &&
                !href.endsWith(".png") &&
                !href.endsWith(".pdf") &&
                !links.contains(href)) {
                
                // 3. URLæ¨¡å¼æ£€æŸ¥ï¼ˆæ”¾å®½æ¡ä»¶ï¼‰
                // æ¥å—åŒ…å«å¹´ä»½çš„URL: /2024/ æˆ– /2025/
                if (href.matches(".*/(20\\d{2})/.*")) {
                    links.add(href);
                    log.debug("Added news link: {}", href);
                    
                    if (links.size() >= maxCount) {
                        break;
                    }
                }
            }
        }
        
        log.info("Parsed {} news links from CCTV (target: {})", links.size(), maxCount);
        
        // 4. å¦‚æœé“¾æ¥ä¸å¤Ÿï¼Œè®°å½•è­¦å‘Š
        if (links.size() < maxCount) {
            log.warn("Only found {} links, less than target {}", links.size(), maxCount);
        }
        
    } catch (Exception e) {
        log.error("Failed to parse news links: {}", e.getMessage(), e);
    }
    
    return links;
}
```

---

## ğŸ§ª æµ‹è¯•æ”¹è¿›æ•ˆæœ

### æµ‹è¯•æ­¥éª¤

1. **ä¿®æ”¹ä»£ç åé‡æ–°ç¼–è¯‘**
```bash
cd backend
mvn clean compile
```

2. **é‡å¯åç«¯**
```bash
mvn spring-boot:run
```

3. **æµ‹è¯•å•ä¸ªçˆ¬è™«**
```bash
# PowerShell
$headers = @{
    "Authorization" = "Bearer {ä½ çš„token}"
}
Invoke-WebRequest -Uri "http://localhost:8080/api/crawler/trigger/cctv?maxCount=10" -Method POST -Headers $headers
```

4. **æŸ¥çœ‹æ—¥å¿—**
```bash
Get-Content backend\logs\news-management.log -Tail 50
```

åº”è¯¥èƒ½çœ‹åˆ°ç±»ä¼¼ï¼š
```
Parsed 10 news links from CCTV (target: 10)  # æˆåŠŸï¼
```

---

## ğŸ“Š ä¸ºä»€ä¹ˆåªèƒ½çˆ¬åˆ°3æ¡ï¼Ÿ

### ç½‘ç«™ç»“æ„åˆ†æ

æˆ‘åˆ†æäº†ä¸€ä¸‹ï¼Œå¯èƒ½çš„åŸå› ï¼š

| æ–°é—»æº | é—®é¢˜ | åŸå›  |
|--------|------|------|
| **CCTV** | åªæœ‰3æ¡ | é¦–é¡µåªæœ‰3æ¡ç¬¦åˆä¸¥æ ¼æ—¥æœŸæ ¼å¼çš„é“¾æ¥ |
| **ç½‘æ˜“** | 0æ¡ | æ­£åˆ™è¡¨è¾¾å¼å¤ªä¸¥æ ¼ï¼Œæ²¡æœ‰åŒ¹é…åˆ°ä»»ä½•é“¾æ¥ |
| **æ–°æµª** | 3æ¡ | æ»šåŠ¨é¡µé¢åŠ è½½æ›´å¤šéœ€è¦JavaScript |

### æ ¹æœ¬åŸå› 

1. **é™æ€çˆ¬è™«çš„å±€é™æ€§**
   - åªèƒ½è·å–HTMLä¸­çš„å†…å®¹
   - æ— æ³•æ‰§è¡ŒJavaScript
   - å¾ˆå¤šç°ä»£ç½‘ç«™ç”¨AjaxåŠ è½½å†…å®¹

2. **é€‰æ‹©å™¨å¤ªä¸¥æ ¼**
   - å¿…é¡»å®Œå…¨åŒ¹é…ç‰¹å®šæ ¼å¼
   - æ–°ç½‘é¡µç»“æ„å˜åŒ–å¯¼è‡´åŒ¹é…å¤±è´¥

3. **é¦–é¡µé“¾æ¥æœ‰é™**
   - æ–°é—»ç½‘ç«™é¦–é¡µé€šå¸¸åªå±•ç¤ºå°‘é‡ç²¾é€‰æ–°é—»
   - éœ€è¦ç¿»é¡µæˆ–è®¿é—®åˆ—è¡¨é¡µæ‰èƒ½è·å–æ›´å¤š

---

## ğŸš€ æœ€ä½³å®è·µå»ºè®®

### å»ºè®®1: ä½¿ç”¨åŠ¨æ€çˆ¬è™«

ä½¿ç”¨ Selenium æˆ– Puppeteerï¼š
```java
// æ·»åŠ ä¾èµ–
<dependency>
    <groupId>org.seleniumhq.selenium</groupId>
    <artifactId>selenium-java</artifactId>
    <version>4.15.0</version>
</dependency>
```

### å»ºè®®2: é™ä½é¢„æœŸ

å¯¹äºç®€å•çš„HTMLçˆ¬è™«ï¼š
- **CCTV**: é¢„æœŸ 3-5 æ¡/æ¬¡
- **æ–°æµª**: é¢„æœŸ 5-8 æ¡/æ¬¡
- **ç½‘æ˜“**: é¢„æœŸ 0-3 æ¡/æ¬¡ï¼ˆéœ€è¦ä¿®å¤ï¼‰

**é‡‡é›†ç­–ç•¥**ï¼š
- å¢åŠ é‡‡é›†é¢‘ç‡ï¼ˆæ¯2å°æ—¶ä¸€æ¬¡ï¼‰
- å¤šæ¬¡é‡‡é›†ç´¯ç§¯æ•°æ®
- ä½¿ç”¨å®šæ—¶ä»»åŠ¡è‡ªåŠ¨é‡‡é›†

### å»ºè®®3: ä½¿ç”¨å®˜æ–¹API

è®¸å¤šæ–°é—»ç½‘ç«™æä¾›APIï¼š
- æ›´ç¨³å®š
- æ›´å¿«é€Ÿ
- æ•°æ®æ›´å®Œæ•´
- ä¸ä¼šè¢«å°ç¦

---

## âš¡ ç«‹å³å¯ç”¨çš„ä¸´æ—¶æ–¹æ¡ˆ

### æ–¹æ¡ˆA: å¤šæ¬¡å°æ‰¹é‡é‡‡é›†

```typescript
// ä¿®æ”¹å‰ç«¯ä»£ç 
async function triggerMultipleCrawls() {
  for (let i = 0; i < 3; i++) {
    await triggerSingleCrawler('cctv', 5)
    await new Promise(resolve => setTimeout(resolve, 30000)) // ç­‰å¾…30ç§’
  }
  ElMessage.success('ç´¯è®¡é‡‡é›†å®Œæˆ')
}
```

### æ–¹æ¡ˆB: ä½¿ç”¨å®šæ—¶ä»»åŠ¡

å¯ç”¨åç«¯çš„å®šæ—¶é‡‡é›†åŠŸèƒ½ï¼š

**æ–‡ä»¶ï¼š** `NewsCrawlerScheduler.java`

```java
@Scheduled(cron = "0 0 */2 * * ?")  // æ¯2å°æ—¶
public void scheduledCrawl() {
    crawlerService.executeAllCrawlers(5);  // æ¯æ¬¡5æ¡
}
```

---

## ğŸ“ æ€»ç»“

**é—®é¢˜**ï¼šè®¾ç½®10æ¡åªé‡‡é›†åˆ°3æ¡  
**åŸå› **ï¼šç½‘é¡µä¸Šåªèƒ½è§£æå‡º3æ¡ç¬¦åˆæ¡ä»¶çš„é“¾æ¥  
**è§£å†³**ï¼š
1. ä¿®æ”¹é€‰æ‹©å™¨å’Œè¿‡æ»¤æ¡ä»¶ï¼ˆä»£ç çº§åˆ«ï¼‰
2. å¤šæ¬¡å°æ‰¹é‡é‡‡é›†ï¼ˆè¿è¥çº§åˆ«ï¼‰
3. ä½¿ç”¨APIæˆ–RSSï¼ˆæ¶æ„çº§åˆ«ï¼‰

**æ¨èåšæ³•**ï¼š
- çŸ­æœŸï¼šå¤šæ¬¡é‡‡é›†ï¼Œç´¯ç§¯æ•°æ®
- é•¿æœŸï¼šæ”¹è¿›çˆ¬è™«ä»£ç ï¼Œä½¿ç”¨API

éœ€è¦æˆ‘å¸®æ‚¨ä¿®æ”¹çˆ¬è™«ä»£ç å—ï¼Ÿ

