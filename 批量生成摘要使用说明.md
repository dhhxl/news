# 📝 批量生成AI摘要使用说明

## ✅ 已完成的更新

### 1. 删除 SINA 新闻源
- ✅ 删除了 `SinaNewsCrawler.java`
- ✅ 重新编译成功
- ✅ 现在只有2个新闻源：CCTV 和 网易

### 2. 添加批量生成AI摘要功能
- ✅ 新闻管理页面添加了多选功能
- ✅ 新增批量操作栏
- ✅ 支持批量生成AI摘要
- ✅ 优化了错误处理

---

## 🎯 批量生成摘要功能

### 功能特性

✨ **智能批量处理**
- 一次选择多条新闻
- 批量生成AI摘要
- 自动跳过已有摘要
- 显示进度和结果

✨ **两种生成模式**
1. **后端批量模式**：调用后端批量接口，异步生成
2. **前端逐个模式**：前端逐个调用，显示实时进度

✨ **智能容错**
- 某条新闻失败不影响其他
- 显示成功/失败统计
- API限流保护（间隔2秒）

---

## 📱 使用方法

### 方式1: 通过管理后台界面（推荐）

#### 步骤1: 登录管理后台
```
访问：http://localhost:5173/login
账号：admin
密码：admin123
```

#### 步骤2: 进入新闻管理
```
点击左侧菜单："新闻管理"
或直接访问：http://localhost:5173/admin/news
```

#### 步骤3: 选择需要生成摘要的新闻
- 在表格左侧勾选复选框
- 可以选择单条或多条新闻
- 选中后会显示蓝色提示栏

#### 步骤4: 批量生成摘要
1. 点击提示栏中的 **"批量生成摘要"** 按钮
2. 确认操作
3. 等待生成完成
4. 查看成功/失败统计

#### 步骤5: 查看生成结果
- 前往新闻详情页查看摘要
- 或在前台页面查看

---

### 方式2: 使用后端批量接口

#### 调用批量生成API（为所有新闻生成）

```powershell
# 1. 登录获取Token
$loginBody = @{
    username = "admin"
    password = "admin123"
} | ConvertTo-Json

$response = Invoke-RestMethod -Uri "http://localhost:8080/api/auth/login" -Method POST -Body $loginBody -ContentType "application/json"
$token = $response.token

# 2. 调用批量生成接口
$headers = @{
    "Authorization" = "Bearer $token"
}

Invoke-RestMethod -Uri "http://localhost:8080/api/summaries/generate/batch" -Method POST -Headers $headers
```

**该接口会：**
- 为所有已发布的新闻生成摘要
- 自动跳过已有摘要的新闻
- 异步执行，不阻塞
- 每条间隔2秒，避免API限流

---

## 🔧 功能详解

### 界面元素

**1. 复选框列**
- 每条新闻前都有复选框
- 支持全选/单选/多选

**2. 批量操作提示栏**
- 选中新闻后自动显示
- 显示已选数量
- 提供批量操作按钮

**3. 批量生成按钮**
- 图标：🪄 魔法棒
- 加载状态：生成时显示loading
- 确认提示：避免误操作

---

### 生成流程

```
1. 用户选择新闻
   ↓
2. 点击"批量生成摘要"
   ↓
3. 弹出确认对话框
   ↓
4. 开始生成（显示进度）
   ↓
5. 逐个调用AI生成
   ↓
6. 显示成功/失败统计
   ↓
7. 自动清除选择
```

---

## 📊 两种生成模式对比

### 模式1: 后端批量模式

**API：** `POST /api/summaries/generate/batch`

**特点：**
- ✅ 速度快（异步处理）
- ✅ 不阻塞前端
- ✅ 服务器端控制
- ❌ 无法实时看到进度

**适用场景：**
- 大量新闻（50+条）
- 不需要实时反馈
- 定时任务

---

### 模式2: 前端逐个模式

**API：** `POST /api/summaries/generate/{newsId}` (多次调用)

**特点：**
- ✅ 实时进度反馈
- ✅ 精确控制
- ✅ 可以随时中断
- ❌ 速度较慢

**适用场景：**
- 少量新闻（<20条）
- 需要看到实时进度
- 选择性生成

---

## ⚙️ 配置选项

### 调整间隔时间

**文件：** `frontend/src/views/admin/NewsManagement.vue:357行`

```typescript
// 当前间隔：2秒
await new Promise(resolve => setTimeout(resolve, 2000))

// 可以调整为其他值：
await new Promise(resolve => setTimeout(resolve, 3000))  // 3秒
await new Promise(resolve => setTimeout(resolve, 1000))  // 1秒（不推荐，可能被限流）
```

### 调整批量数量限制

**文件：** `SummaryService.java:124行`

```java
newsRepository.findByStatus("PUBLISHED", 
    PageRequest.of(0, 100))  // 当前：每次100条
```

可以调整为：
- 50条（更快）
- 200条（更多）

---

## 🆘 故障排除

### 问题1: 403 Forbidden

**原因：** Token过期或未登录

**解决：**
1. 重新登录：http://localhost:5173/login
2. 使用 admin / admin123 登录
3. 立即测试（Token有效期30分钟）

---

### 问题2: 500 Internal Server Error

**可能原因：**
1. API Key 未配置
2. 新闻已有摘要（重复key）
3. 网络问题

**解决：**
```sql
-- 查看哪些新闻已有摘要
SELECT news_id FROM summaries;

-- 删除所有摘要（重新生成）
DELETE FROM summaries;
```

---

### 问题3: Timeout 超时

**原因：** AI生成时间较长

**解决：**
- 已将超时时间增加到60秒
- 如果仍超时，检查网络连接
- 或暂时减少批量数量

---

### 问题4: 部分新闻生成失败

**这是正常的！**

可能原因：
- 新闻内容为空
- API临时错误
- 网络波动

**查看失败详情：**
- 前端会显示失败的新闻标题
- 后端日志中有详细错误

---

## 📈 性能参考

### 单条生成
- 时间：3-10秒
- 成功率：95%+

### 批量生成（前端模式）
- 10条新闻：约30-60秒
- 20条新闻：约60-120秒
- 成功率：90%+

### 批量生成（后端模式）
- 任意数量：立即返回
- 后台处理：取决于数量
- 成功率：95%+

---

## 🚀 快速开始

### 立即测试（重启后）

1. **重启后端**
   ```powershell
   cd backend
   mvn spring-boot:run
   ```

2. **访问管理后台**
   ```
   http://localhost:5173/admin/news
   ```

3. **选择2-3条新闻**
   - 勾选复选框

4. **点击批量生成摘要**
   - 观察进度提示
   - 等待完成

5. **查看结果**
   - 查看新闻详情
   - 应该能看到AI生成的摘要

---

## 📊 可用新闻源

### 更新后的爬虫列表

| 新闻源 | 状态 | 描述 |
|--------|------|------|
| 📺 **CCTV** | ✅ 保留 | 中央电视台官方新闻，支持多页面采集 |
| 📱 **网易** | ✅ 保留 | 网易新闻频道，支持多页面采集 |
| 📰 **新浪** | ❌ 已删除 | 已移除 |

### 验证爬虫源

访问：http://localhost:5173/admin/crawler

应该只能看到 CCTV 和 NETEASE 两个源。

---

## 💡 使用建议

### 最佳实践

1. **首次使用**
   - 先选择1-2条新闻测试
   - 确认AI配置正常
   - 再批量处理

2. **日常使用**
   - 新闻采集后立即批量生成摘要
   - 每次选择10-20条
   - 避免一次选择过多

3. **定期维护**
   - 定期检查失败的摘要
   - 重新生成失败的记录
   - 清理无用数据

---

## 🎉 功能亮点

### 用户体验优化

✅ **可视化选择** - 复选框清晰易用
✅ **实时反馈** - 显示处理进度
✅ **智能提示** - 成功/失败都有提示
✅ **批量处理** - 一键操作多条
✅ **容错机制** - 部分失败不影响整体

---

**现在重启后端，访问管理后台就可以使用批量生成AI摘要功能了！** 🚀

